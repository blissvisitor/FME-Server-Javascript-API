var FMEServer=function(){function getConfig(param){return param=param||null,param?config[param]:config}function checkConfig(){if(getConfig().server&&getConfig().token)return!0;throw new Error("You must initialize FMEServer using the FMEServer.init() method.")}function ajax(url,callback,rtyp,params,ctyp,atyp){if(checkConfig()){if(null===callback||"function"!=typeof callback)throw new Error("A callback function must be defined in order to use the FME Server REST API.");var req;if(rtyp=rtyp||"GET",params=params||null,ctyp=ctyp||null,atyp=atyp||getConfig("accept"),url+=-1!=url.indexOf("?")?"&detail="+getConfig("detail")+"&token="+getConfig("token"):"?detail="+getConfig("detail")+"&token="+getConfig("token"),getConfig("xdomain")){if("GET"!=rtyp)throw new Error("IE8 and IE9 Only support CORS requests through GET methods. Only partial functionality is available.");req=new XDomainRequest,req.open(rtyp,url),req.onload=function(){var resp;resp=req.responseText;try{resp=JSON.parse(resp)}catch(e){}finally{callback(resp)}},req.send()}else req=new XMLHttpRequest,req.open(rtyp,url,!0),null!==atyp&&req.setRequestHeader("Accept",atyp),null!==ctyp&&"attachment"!=ctyp&&req.setRequestHeader("Content-type",ctyp),"attachment"==ctyp&&(req.setRequestHeader("Content-type","application/octet-stream"),req.setRequestHeader("Content-Disposition",'attachment; filename="'+params.name+'"'),params=params.contents),req.onreadystatechange=function(){var done=4;if(req.readyState==done){var resp;try{resp=req.responseText,0===resp.length&&204==req.status?resp='{ "delete" : "true" }':0===resp.length&&202==req.status&&(resp='{ "value" : "true" }'),resp=JSON.parse(resp)}catch(e){resp=req.response}finally{callback(resp)}}},req.send(params)}}function buildURL(url){return url=url.replace(/{{svr}}/g,getConfig("server")),url=url.replace(/{{ver}}/g,getConfig("version"))}Array.prototype.indexOf||(Array.prototype.indexOf=function(obj,start){for(var i=start||0,j=this.length;j>i;i++)if(this[i]===obj)return i;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var config={version:"v2"},fme={init:function(server,token,format,detail,port,ssl){if(void 0===server||"object"==typeof server&&void 0===server.server)throw new Error("You did not specify a server URL in your configuration paramaters.");if(void 0===token&&"object"==typeof server&&void 0===server.token)throw new Error("You did not specify a token in your configuration paramaters.");"object"==typeof server?(getConfig().server=server.server,getConfig().token=server.token,getConfig().accept=server.format||"json",getConfig().detail=server.detail||"high",getConfig().port=server.port||"80",getConfig().ssl=server.ssl||!1,getConfig().xdomain=!1):(getConfig().server=server,getConfig().token=token,getConfig().accept=format||"json",getConfig().detail=detail||"high",getConfig().port=port||"80",getConfig().ssl=ssl||!1,getConfig().xdomain=!1),"/"==getConfig("server").charAt(getConfig("server").length-1)&&(getConfig().server=getConfig("server").substr(0,getConfig("server").length-1)),"http"!=getConfig("server").substring(0,4)&&(getConfig().server="http://"+getConfig("server")),getConfig("ssl")&&(getConfig().server=getConfig("server").replace("http://","https://")),location.host==getConfig("server").split("//")[1].split("/")[0]||"Microsoft Internet Explorer"!=navigator.appName||-1===navigator.appVersion.indexOf("MSIE 9")&&-1===navigator.appVersion.indexOf("MSIE 8")||(getConfig().xdomain=!0);var stdPorts=["80","443"];-1===stdPorts.indexOf(getConfig("port"))&&(getConfig().server=getConfig("server")+":"+getConfig("port"))},getSession:function(repository,workspace,callback){callback=callback||null;var url=buildURL("{{svr}}/fmedataupload/"+repository+"/"+workspace),params="opt_extractarchive=false&opt_pathlevel=3&opt_fullpath=true";ajax(url,callback,"POST",params,"application/x-www-form-urlencoded")},getWebSocketConnection:function(id,callback){callback=callback||null;var url;url=-1!=getConfig("server").indexOf("https://")?getConfig("server").replace("https://",""):getConfig("server").replace("http://","");var ws=new WebSocket("ws://"+url+":7078/websocket");return ws.onopen=function(){var openMsg={ws_op:"open",ws_stream_id:id};ws.send(JSON.stringify(openMsg)),null!==callback&&callback()},ws},runDataDownload:function(repository,workspace,params,callback){callback=callback||null;var url=buildURL("{{svr}}/fmedatadownload/"+repository+"/"+workspace);params="opt_responseformat="+getConfig("accept")+"&opt_showresult=true&"+params,ajax(url,callback,"POST",params,"application/x-www-form-urlencoded")},dataUpload:function(repository,workspace,files,jsid,callback){callback=callback||null,jsid=jsid||null;var url=buildURL("{{svr}}/fmedataupload/"+repository+"/"+workspace);if(null!==jsid&&(url+=";jsessionid="+jsid),FormData){for(var params=new FormData,i=0;i<files.files.length;i++)params.append("files[]",files.files[i]);ajax(url,callback,"POST",params)}else{var random=parseInt(1e8*Math.random()),iframe=document.createElement("iframe");iframe.id=random+"-frame",iframe.name=random,iframe.style.display="none",document.body.appendChild(iframe);var form=document.createElement("form");form.action=url,form.method="POST",form.enctype="multipart/form-data";var input=files.cloneNode(!0);input.name="files[]",input.files=files.files,form.appendChild(input),form.target=random,form.id=random+"-form",form.style.display="none",document.body.appendChild(form),form.submit(),callback({submit:!0,id:random})}},getDataUploads:function(repository,workspace,jsid,callback){callback=callback||null,jsid=jsid||null;var url=buildURL("{{svr}}/fmedataupload/"+repository+"/"+workspace+";jsessionid="+jsid);ajax(url,callback)},runWorkspaceWithData:function(path,params,callback){callback=callback||null,path=path||null;var service=params.service||"fmedatadownload",url=buildURL("{{svr}}/"+service+"/"+repository+"/"+workspace+"?"),files=params.files,extra=params.params;params=params.filename+"=%22%22";for(var f in files)params+=path+"/"+files[f].name+"%22%20%22";params+="&"+extra+"&opt_responseformat=json",ajax(url+params,callback)},getRepositories:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/repositories");ajax(url,callback)},getRepositoryItems:function(repository,type,callback){type=type||"",callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/repositories/"+repository+"/items?type="+type);ajax(url,callback)},getWorkspaceParameters:function(repository,workspace,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/repositories/"+repository+"/items/"+workspace+"/parameters");ajax(url,callback)},generateFormItems:function(id,json){for(var form=document.getElementById(id),i=0;i<json.length;i++){var param=json[i],span=document.createElement("span");span.setAttribute("class",param.name+" fmes-form-component");var label=document.createElement("label");label.innerHTML=param.description,span.appendChild(label);var choice;if("FILE_OR_URL"===param.type)choice=document.createElement("input"),choice.type="file",choice.name=param.name;else if("LISTBOX"===param.type){choice=document.createElement("div");for(var options=param.listOptions,a=0;a<options.length;a++){var option=options[a],checkbox=document.createElement("input");checkbox.type="checkbox",checkbox.value=option.value,checkbox.name=param.name,choice.appendChild(checkbox);var caption=document.createElement("label");caption.innerHTML=option.caption,choice.appendChild(caption)}}else if("LOOKUP_CHOICE"===param.type||"STRING_OR_CHOICE"===param.type||"CHOICE"===param.type){choice=document.createElement("select"),choice.name=param.name;for(var options=param.listOptions,a=0;a<options.length;a++){var option=options[a],optionItem=document.createElement("option");optionItem.innerHTML=option.caption,optionItem.value=option.value,choice.appendChild(optionItem)}}else"TEXT_EDIT"===param.type?(choice=document.createElement("textarea"),choice.name=param.name):"INTEGER"==param.type?(choice=document.createElement("input"),choice.type="number",choice.name=param.name):"PASSWORD"==param.type?(choice=document.createElement("input"),choice.type="password",choice.name=param.name):(choice=document.createElement("input"),choice.value=param.defaultValue,choice.name=param.name);span.appendChild(choice),form.appendChild(span)}},getSchedules:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules");ajax(url,callback)},getScheduleItem:function(category,item,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules/"+category+"/"+item);ajax(url,callback)},enableScheduleItem:function(category,item,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules/"+category+"/"+item+"/enabled"),params="value=true";ajax(url,callback,"PUT",params,"application/x-www-form-urlencoded")},disableScheduleItem:function(category,item,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules/"+category+"/"+item+"/enabled"),params="value=false";ajax(url,callback,"PUT",params,"application/x-www-form-urlencoded")},replaceScheduleItem:function(category,item,schedule,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules/"+category+"/"+item),params=JSON.stringify(schedule);ajax(url,callback,"PUT",params,"application/json")},removeScheduleItem:function(category,item,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules/"+category+"/"+item);ajax(url,callback,"DELETE")},createScheduleItem:function(schedule,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/schedules"),params=JSON.stringify(schedule);ajax(url,callback,"POST",params,"application/json")},getAllPublications:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publications");ajax(url,callback)},getPublication:function(name,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publications/"+name);ajax(url,callback)},createPublication:function(publication,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publications"),params=JSON.stringify(publication);ajax(url,callback,"POST",params,"application/json")},updatePublication:function(name,publication,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publications/"+name),params=JSON.stringify(publication);ajax(url,callback,"PUT",params,"application/json")},deletePublication:function(name,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publications/"+name);ajax(url,callback,"DELETE")},getPublisherProtocols:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publishers/");ajax(url,callback)},queryPublisherProtocol:function(name,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/publishers/"+name);ajax(url,callback)},getAllSubscriptions:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscriptions");ajax(url,callback)},getSubscription:function(name,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscription/"+name);ajax(url,callback)},createSubscription:function(subscription,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscriptions"),params=JSON.stringify(subscription);ajax(url,callback,"POST",params,"application/json")},updateSubscription:function(name,subscription,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscription/"+name),params=JSON.stringify(subscription);ajax(url,callback,"PUT",params,"application/json")},deleteSubscription:function(name,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscriptions/"+name);ajax(url,callback,"DELETE")},getSubscriberProtocols:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscribers/");ajax(url,callback)},querySubscriberProtocol:function(name,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/subscribers/"+name);ajax(url,callback)},getNotificationTopics:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics");ajax(url,callback)},getNotificationTopic:function(name,callback){callback=callback||null,name=encodeURIComponent(name);var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics"+name);ajax(url,callback)},createTopic:function(name,description,callback){callback=callback||null,name=encodeURIComponent(name).replace(/%20/g,"+"),description=encodeURIComponent(description).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics"),params="name="+name+"&description="+description;ajax(url,callback,"POST",params,"application/x-www-form-urlencoded")},updateTopic:function(name,description,callback){callback=callback||null,name=encodeURIComponent(name),description=encodeURIComponent(description).replace(/%20/g,"+");var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics"+name),params="description="+description;ajax(url,callback,"PUT",params,"application/x-www-form-urlencoded")},deleteTopic:function(name,callback){callback=callback||null,name=encodeURIComponent(name);var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics"+name);ajax(url,callback,"DELETE",null,"application/x-www-form-urlencoded")},publishToTopicStructured:function(name,params,type,callback){callback=callback||null,name=encodeURIComponent(name),type=type.toLowerCase()||"json";var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics/"+name+"/message/map");if("xml"==type)type="application/xml";else{type="application/json";try{params=JSON.parse(params),params=JSON.stringify(params)}catch(e){var message={message:"Unable to parse JSON"};return callback(message),!1}}ajax(url,callback,"POST",params,type)},publishToTopic:function(name,params,callback){callback=callback||null,name=encodeURIComponent(name);var url=buildURL("{{svr}}/fmerest/{{ver}}/notifications/topics/"+name+"/message/raw");ajax(url,callback,"POST",params,"*/*")},lookupToken:function(user,password,callback){callback=callback||null;var url=buildURL("{{svr}}/fmetoken/service/view.json"),params="user="+user+"&password="+password;ajax(url,callback,"POST",params,"application/x-www-form-urlencoded")},generateToken:function(user,password,count,unit,callback){callback=callback||null;var url=buildURL("{{svr}}/fmetoken/service/generate"),params="user="+user+"&password="+password+"&expiration="+count+"&timeunit="+unit;ajax(url,callback,"POST",params,"application/x-www-form-urlencoded")},submitJob:function(repository,workspace,params,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/transformations/commands/submit/"+repository+"/"+workspace);params=JSON.stringify(params),ajax(url,callback,"POST",params,"application/json")},submitSyncJob:function(repository,workspace,params,callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/transformations/commands/transact/"+repository+"/"+workspace);params=JSON.stringify(params),ajax(url,callback,"POST",params,"application/json")},getResources:function(callback){callback=callback||null;var url=buildURL("{{svr}}/fmerest/{{ver}}/resources");ajax(url,callback)},getResourceDetails:function(resource,path,callback){callback=callback||null,path=encodeURIComponent(path).replace(/%2F/g,"/");var url=buildURL("{{svr}}/fmerest/{{ver}}/resources/"+resource+"/filesys"+path);ajax(url,callback)},deleteResource:function(resource,path,callback){callback=callback||null,path=encodeURIComponent(path).replace(/%2F/g,"/");var url=buildURL("{{svr}}/fmerest/{{ver}}/resources/"+resource+"/filesys"+path);ajax(url,callback,"DELETE")},downloadResourceFile:function(resource,path){path=encodeURIComponent(path).replace(/%2F/g,"/");var url=buildURL("{{svr}}/fmerest/{{ver}}/resources/"+resource+"/filesys"+path+"?accept=contents"),iframe=document.createElement("iframe");iframe.style.display="none",document.body.appendChild(iframe),iframe.src=url+"&token="+getConfig("token")},uploadResourceFile:function(resource,path,params,callback,overwrite,createFolders){callback=callback||null,overwrite=overwrite||!1,createFolders=createFolders||!1,path=encodeURIComponent(path).replace(/%2F/g,"/");var url=buildURL("{{svr}}/fmerest/{{ver}}/resources/"+resource+"/filesys"+path);url=url+"?createDirectories="+createFolders+"&overwrite="+overwrite+"&type=FILE",ajax(url,callback,"POST",params,"attachment")},customRequest:function(url,type,callback,params,ctyp){callback=callback||null,params=params||null,type=type.toUpperCase(),ctyp=ctyp||null,ajax(url,callback,type,params,ctyp)}};return fme}();