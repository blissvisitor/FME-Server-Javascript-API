var FMEServer=(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(k,l){for(var h=(l||0),g=this.length;h<g;h++){if(this[h]===k){return h}}return -1}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var c={version:"v2"};function b(g){g=g||null;if(g){return c[g]}return c}function f(){if(b().server&&b().token){return true}throw new Error("You must initialize FMEServer using the FMEServer.init() method.")}function e(h,m,i,l,k,g){if(f()){if(m===null||typeof m!="function"){throw new Error("A callback function must be defined in order to use the FME Server REST API.")}var j;i=i||"GET";l=l||null;k=k||null;g=g||b("accept");if(h.indexOf("?")!=-1){h+="&detail="+b("detail")}else{h+="?detail="+b("detail")}if(b("xdomain")){if(i=="GET"){j=new XDomainRequest();h+="&token="+b("token");j.open(i,h);j.onload=function(){var o;o=j.responseText;try{o=JSON.parse(o)}catch(n){}finally{m(o)}};j.send()}else{throw new Error("IE8 and IE9 Only support CORS requests through GET methods. Only partial functionality is available.")}}else{j=new XMLHttpRequest();j.open(i,h,true);j.setRequestHeader("Authorization","fmetoken token="+b("token"));if(g!==null){j.setRequestHeader("Accept",g)}if(k!==null&&k!="attachment"){j.setRequestHeader("Content-type",k)}if(k=="attachment"){j.setRequestHeader("Content-type","application/octet-stream");j.setRequestHeader("Content-Disposition",'attachment; filename="'+l.name+'"');l=l.contents}j.onreadystatechange=function(){var n=4;if(j.readyState==n){var p;try{p=j.responseText;if(p.length===0&&j.status==204){p='{ "delete" : "true" }'}else{if(p.length===0&&j.status==202){p='{ "value" : "true" }'}}p=JSON.parse(p)}catch(o){p=j.response}finally{m(p)}}};j.send(l)}}}function a(g){g=g.replace(/{{svr}}/g,b("server"));g=g.replace(/{{ver}}/g,b("version"));return g}var d={init:function(m,j,l,k,h,g){if(m===undefined||(typeof m==="object"&&m.server===undefined)){throw new Error("You did not specify a server URL in your configuration paramaters.")}else{if(j===undefined&&(typeof m==="object"&&m.token===undefined)){throw new Error("You did not specify a token in your configuration paramaters.")}}if(typeof m=="object"){b().server=m.server;b().token=m.token;b().accept=m.format||"json";b().detail=m.detail||"high";b().port=m.port||"80";b().ssl=m.ssl||false;b().xdomain=false}else{b().server=m;b().token=j;b().accept=l||"json";b().detail=k||"high";b().port=h||"80";b().ssl=g||false;b().xdomain=false}if(b("server").charAt(b("server").length-1)=="/"){b().server=b("server").substr(0,b("server").length-1)}if(b("server").substring(0,4)!="http"){b().server="http://"+b("server")}if(b("ssl")){b().server=b("server").replace("http://","https://")}if(location.host!=b("server").split("//")[1].split("/")[0]&&navigator.appName=="Microsoft Internet Explorer"&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 8")!==-1)){b().xdomain=true}var i=["80","443"];if(i.indexOf(b("port"))===-1){b().server=b("server")+":"+b("port")}},getSession:function(i,g,k){k=k||null;var h=a("{{svr}}/fmedataupload/"+i+"/"+g);var j="opt_extractarchive=false&opt_pathlevel=3&opt_fullpath=true";e(h,k,"POST",j,"application/x-www-form-urlencoded")},getWebSocketConnection:function(j,i){i=i||null;var h;if(b("server").indexOf("https://")!=-1){h=b("server").replace("https://","wss://")}else{h=b("server").replace("http://","ws://")}var g=new WebSocket(h+":7078/websocket");g.onopen=function(){var k={ws_op:"open",ws_stream_id:j};g.send(JSON.stringify(k));if(i!==null){i()}};return g},runDataDownload:function(i,g,j,k){k=k||null;var h=a("{{svr}}/fmedatadownload/"+i+"/"+g);j="opt_responseformat="+b("accept")+"&opt_showresult=true&"+j;e(h,k,"POST",j,"application/x-www-form-urlencoded")},runDataStreaming:function(i,g,j,k){k=k||null;var h=a("{{svr}}/fmedatastreaming/"+i+"/"+g);j="opt_showresult=true&"+j;e(h,k,"POST",j,"application/x-www-form-urlencoded")},dataUpload:function(q,l,g,p,s){s=s||null;p=p||null;var h=a("{{svr}}/fmedataupload/"+q+"/"+l);if(p!==null){h+=";jsessionid="+p}if(!FormData){var k=parseInt(Math.random()*100000000);var n=document.createElement("iframe");n.id=k+"-frame";n.name=k;n.style.display="none";document.body.appendChild(n);var j=document.createElement("form");j.action=h;j.method="POST";j.enctype="multipart/form-data";var r=g.cloneNode(true);r.name="files[]";r.files=g.files;j.appendChild(r);j.target=k;j.id=k+"-form";j.style.display="none";document.body.appendChild(j);j.submit();s({submit:true,id:k})}else{var m=new FormData();for(var o=0;o<g.files.length;o++){m.append("files[]",g.files[o])}e(h,s,"POST",m)}},getDataUploads:function(j,h,g,k){k=k||null;g=g||null;var i=a("{{svr}}/fmedataupload/"+j+"/"+h+";jsessionid="+g);e(i,k)},runWorkspaceWithData:function(l,m,n){n=n||null;l=l||null;var h=m.service||"fmedatadownload";var i=a("{{svr}}/"+h+"/"+repository+"/"+workspace+"?");var j=m.files;var g=m.params;m=m.filename+"=%22%22";for(var k in j){m+=l+"/"+j[k].name+"%22%20%22"}m+="&"+g+"&opt_responseformat=json";e(i+m,n)},getRepositories:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/repositories");e(g,h)},getRepositoryItems:function(i,h,j){h=h||"";j=j||null;var g=a("{{svr}}/fmerest/{{ver}}/repositories/"+i+"/items?type="+h);e(g,j)},getWorkspaceParameters:function(i,g,j){j=j||null;var h=a("{{svr}}/fmerest/{{ver}}/repositories/"+i+"/items/"+g+"/parameters");e(h,j)},getWorkspaceParameter:function(i,g,k,j){j=j||null;var h=a("{{svr}}/fmerest/{{ver}}/repositories/"+i+"/items/"+g+"/parameters/"+k);e(h,j)},generateFormItems:function(g,u,o){var h=document.getElementById(g);for(var l=0;l<u.length;l++){var j=u[l];if(!o||o.indexOf(j.name)!==-1){var r=document.createElement("span");r.setAttribute("class",j.name+" fmes-form-component");var q=document.createElement("label");q.innerHTML=j.description;r.appendChild(q);var k;if(j.type==="FILE_OR_URL"){k=document.createElement("input");k.type="file";k.name=j.name}else{if(j.type==="LISTBOX"){k=document.createElement("div");var v=j.listOptions;for(var p=0;p<v.length;p++){var m=v[p];var n=document.createElement("input");n.type="checkbox";n.value=m.value;n.name=j.name;k.appendChild(n);var t=document.createElement("label");t.innerHTML=m.caption;k.appendChild(t)}}else{if(j.type==="LOOKUP_CHOICE"||j.type==="LOOKUP_LISTBOX"||j.type==="STRING_OR_CHOICE"||j.type==="CHOICE"){k=document.createElement("select");k.name=j.name;var v=j.listOptions;for(var p=0;p<v.length;p++){var m=v[p];var s=document.createElement("option");s.innerHTML=m.caption;s.value=m.value;k.appendChild(s)}}else{if(j.type==="TEXT_EDIT"){k=document.createElement("textarea");k.name=j.name}else{if(j.type=="INTEGER"){k=document.createElement("input");k.type="number";k.name=j.name}else{if(j.type=="PASSWORD"){k=document.createElement("input");k.type="password";k.name=j.name}else{k=document.createElement("input");k.value=j.defaultValue;k.name=j.name}}}}}}r.appendChild(k);h.appendChild(r)}}},getSchedules:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules");e(g,h)},getScheduleItem:function(i,h,j){j=j||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules/"+i+"/"+h);e(g,j)},enableScheduleItem:function(i,h,k){k=k||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules/"+i+"/"+h+"/enabled");var j="value=true";e(g,k,"PUT",j,"application/x-www-form-urlencoded")},disableScheduleItem:function(i,h,k){k=k||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules/"+i+"/"+h+"/enabled");var j="value=false";e(g,k,"PUT",j,"application/x-www-form-urlencoded")},replaceScheduleItem:function(i,h,k,l){l=l||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules/"+i+"/"+h);var j=JSON.stringify(k);e(g,l,"PUT",j,"application/json")},removeScheduleItem:function(i,h,j){j=j||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules/"+i+"/"+h);e(g,j,"DELETE")},createScheduleItem:function(i,j){j=j||null;var g=a("{{svr}}/fmerest/{{ver}}/schedules");var h=JSON.stringify(i);e(g,j,"POST",h,"application/json")},getAllPublications:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/publications");e(g,h)},getPublication:function(h,i){i=i||null;h=encodeURIComponent(h).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/publications/"+h);e(g,i)},createPublication:function(g,j){j=j||null;var h=a("{{svr}}/fmerest/{{ver}}/notifications/publications");var i=JSON.stringify(g);e(h,j,"POST",i,"application/json")},updatePublication:function(i,g,k){k=k||null;i=encodeURIComponent(i).replace(/%20/g,"+");var h=a("{{svr}}/fmerest/{{ver}}/notifications/publications/"+i);var j=JSON.stringify(g);e(h,k,"PUT",j,"application/json")},deletePublication:function(h,i){i=i||null;h=encodeURIComponent(h).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/publications/"+h);e(g,i,"DELETE")},getPublisherProtocols:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/publishers/");e(g,h)},queryPublisherProtocol:function(h,i){i=i||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/publishers/"+h);e(g,i)},getAllSubscriptions:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscriptions");e(g,h)},getSubscription:function(h,i){i=i||null;h=encodeURIComponent(h).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscriptions/"+h);e(g,i)},createSubscription:function(h,j){j=j||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscriptions");var i=JSON.stringify(h);e(g,j,"POST",i,"application/json")},updateSubscription:function(h,i,k){k=k||null;h=encodeURIComponent(h).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscription/"+h);var j=JSON.stringify(i);e(g,k,"PUT",j,"application/json")},deleteSubscription:function(h,i){i=i||null;h=encodeURIComponent(h).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscriptions/"+h);e(g,i,"DELETE")},getSubscriberProtocols:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscribers/");e(g,h)},querySubscriberProtocol:function(h,i){i=i||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/subscribers/"+h);e(g,i)},getNotificationTopics:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics");e(g,h)},getNotificationTopic:function(h,i){i=i||null;h=encodeURIComponent(h);var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics/"+h);e(g,i)},createTopic:function(h,i,k){k=k||null;h=encodeURIComponent(h).replace(/%20/g,"+");i=encodeURIComponent(i).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics");var j="name="+h+"&description="+i;e(g,k,"POST",j,"application/x-www-form-urlencoded")},updateTopic:function(h,i,k){k=k||null;h=encodeURIComponent(h);i=encodeURIComponent(i).replace(/%20/g,"+");var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics/"+h);var j="description="+i;e(g,k,"PUT",j,"application/x-www-form-urlencoded")},deleteTopic:function(h,i){i=i||null;h=encodeURIComponent(h);var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics/"+h);e(g,i,"DELETE",null,"application/x-www-form-urlencoded")},publishToTopicStructured:function(h,l,i,m){m=m||null;h=encodeURIComponent(h);i=i.toLowerCase()||"json";var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics/"+h+"/message/map");if(i=="xml"){i="application/xml"}else{i="application/json";try{l=JSON.parse(l);l=JSON.stringify(l)}catch(k){var j={message:"Unable to parse JSON"};m(j);return false}}e(g,m,"POST",l,i)},publishToTopic:function(h,i,j){j=j||null;h=encodeURIComponent(h);var g=a("{{svr}}/fmerest/{{ver}}/notifications/topics/"+h+"/message/raw");e(g,j,"POST",i,"*/*")},lookupToken:function(g,i,k){k=k||null;var h=a("{{svr}}/fmetoken/service/view.json");var j="user="+g+"&password="+i;e(h,k,"POST",j,"application/x-www-form-urlencoded")},generateToken:function(g,i,k,j,m){m=m||null;var h=a("{{svr}}/fmetoken/service/generate");var l="user="+g+"&password="+i+"&expiration="+k+"&timeunit="+j;e(h,m,"POST",l,"application/x-www-form-urlencoded")},submitJob:function(i,g,j,k){k=k||null;var h=a("{{svr}}/fmerest/{{ver}}/transformations/commands/submit/"+i+"/"+g);j=JSON.stringify(j);e(h,k,"POST",j,"application/json")},submitSyncJob:function(i,g,j,k){k=k||null;var h=a("{{svr}}/fmerest/{{ver}}/transformations/commands/transact/"+i+"/"+g);j=JSON.stringify(j);e(h,k,"POST",j,"application/json")},getResources:function(h){h=h||null;var g=a("{{svr}}/fmerest/{{ver}}/resources");e(g,h)},getResourceDetails:function(h,i,j){j=j||null;i=encodeURIComponent(i).replace(/%2F/g,"/");var g=a("{{svr}}/fmerest/{{ver}}/resources/"+h+"/filesys"+i);e(g,j)},deleteResource:function(h,i,j){j=j||null;i=encodeURIComponent(i).replace(/%2F/g,"/");var g=a("{{svr}}/fmerest/{{ver}}/resources/"+h+"/filesys"+i);e(g,j,"DELETE")},downloadResourceFile:function(i,j){j=encodeURIComponent(j).replace(/%2F/g,"/");var g=a("{{svr}}/fmerest/{{ver}}/resources/"+i+"/filesys"+j+"?accept=contents");var h=document.createElement("iframe");h.style.display="none";document.body.appendChild(h);h.src=g+"&token="+b("token")},uploadResourceFile:function(j,k,l,m,h,i){m=m||null;h=h||false;i=i||false;k=encodeURIComponent(k).replace(/%2F/g,"/");var g=a("{{svr}}/fmerest/{{ver}}/resources/"+j+"/filesys"+k);g=g+"?createDirectories="+i+"&overwrite="+h+"&type=FILE";e(g,m,"POST",l,"attachment")},customRequest:function(g,h,k,j,i){k=k||null;j=j||null;h=h.toUpperCase();i=i||null;e(g,k,h,j,i)}};return d}());